<!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lore Web - Admin & Pembaca</title>
  <style>
    body { font-family: sans-serif; background: #111; color: #eee; padding: 1rem; }
    .hidden { display: none; }
    .card { border: 1px solid #444; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; background: #222; }
    input, textarea { width: 100%; margin-bottom: 1rem; padding: 0.5rem; background: #000; color: #eee; border: 1px solid #555; border-radius: 4px; }
    button { padding: 0.5rem 1rem; background: #444; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #666; }
    h2 { color: #66f; }
  </style>
</head>
<body>
  <div id="admin-section" class="hidden">
    <h2>Admin Panel</h2>
    <input type="text" id="title" placeholder="Judul Chapter">
    <textarea id="content" placeholder="Isi cerita..."></textarea>
    <input type="password" id="token" placeholder="GitHub Token">
    <button onclick="publish()">Publish ke GitHub</button>
    <p id="status"></p>
  </div>  <div id="reader-section">
    <h2>üìñ Pembaca - Daftar Chapter</h2>
    <div id="chapters"></div>
    <hr>
    <button onclick="showAdmin()">Masuk Admin</button>
  </div>  <script>
    const username = "zetajones-star";
    const repo = "khassy-and-khassa";
    const filePath = "chapters.json";
    const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/${filePath}`;
    let sha = "";

    async function fetchChapters() {
      try {
        const res = await fetch(`https://raw.githubusercontent.com/${username}/${repo}/main/${filePath}`);
        const data = await res.json();
        renderChapters(data);
      } catch (e) {
        document.getElementById('chapters').innerHTML = '<p>Belum ada data.</p>';
      }
    }

    function renderChapters(data) {
      const container = document.getElementById('chapters');
      container.innerHTML = '';
      data.forEach(c => {
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `<h3>${c.title}</h3><p>${c.content.replace(/\n/g, '<br>')}</p>`;
        container.appendChild(div);
      });
    }

    async function publish() {
      const title = document.getElementById('title').value.trim();
      const content = document.getElementById('content').value.trim();
      const token = document.getElementById('token').value.trim();
      const statusEl = document.getElementById('status');
      statusEl.textContent = "Menyimpan...";

      if (!title || !content || !token) return alert("Semua field harus diisi.");

      let oldContent = [];
      try {
        const res = await fetch(apiUrl, {
          headers: {
            Authorization: `Bearer ${token}`,
            Accept: "application/vnd.github.v3+json"
          }
        });
        const json = await res.json();
        sha = json.sha;
        const fileContent = atob(json.content.replace(/\n/g, ""));
        oldContent = JSON.parse(fileContent);
      } catch (e) {
        statusEl.textContent = "Gagal ambil file lama. Gunakan array kosong.";
      }

      oldContent.push({ title, content });

      const encoded = btoa(JSON.stringify(oldContent, null, 2));

      try {
        const updateRes = await fetch(apiUrl, {
          method: "PUT",
          headers: {
            Authorization: `Bearer ${token}`,
            Accept: "application/vnd.github.v3+json",
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: `Tambah chapter: ${title}`,
            content: encoded,
            sha
          })
        });
        if (updateRes.ok) {
          statusEl.textContent = "‚úÖ Berhasil dipublish!";
          fetchChapters();
        } else {
          statusEl.textContent = "‚ùå Gagal publish.";
        }
      } catch (e) {
        statusEl.textContent = "‚ùå Error saat upload.";
      }
    }

    function showAdmin() {
      const pw = prompt("Masukkan password admin:");
      if (pw === "Zeta-Jones") {
        document.getElementById('admin-section').classList.remove('hidden');
        document.getElementById('reader-section').classList.add('hidden');
      }
    }

    fetchChapters();
  </script></body>
</html>
